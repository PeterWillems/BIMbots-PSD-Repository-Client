<div class="card">
  <div class="row card-header">
    <h5>Information Delivery Specifications</h5>
    <button (click)="onAddIdsClicked()" [disabled]="getToken() == null" type="button" class="col-1 btn"
            style="color: #15a589; background: transparent; margin: 0px; padding: 0px">
      <fa-icon [icon]="faPlusCircle" size="3x" ngbTooltip="Add an Information Delivery Specification"
               placement="right"></fa-icon>
    </button>
    <span *ngIf="loadingAllIDSs">
      <fa-icon [icon]="faSpinner" size="2x" fixedWidth></fa-icon>
      <span class="sr-only">Loading...</span></span></div>
  <div *ngIf="allIDSs" class="card-body">
    <table class="table">
      <thead>
      <th>id</th>
      <th>name</th>
      </thead>
      <tbody>
      <tr [class]="selectedIDS?(ids.name===selectedIDS.name?'selected-item link-item':'link-item'):'link-item'"
          (click)="onClickIds(ids)"
          *ngFor="let ids of allIDSs">
        <td class="d-sm-table-cell">{{ids.id}}</td>
        <td>{{ids.name}}</td>
        <td *ngIf="isLoadingIDS(ids)"><i class="fa fa-spinner fa-pulse fa-2x fa-fw"></i>
          <span class="sr-only">Loading...</span></td>
      </tr>
      </tbody>
    </table>
    <div class="card" *ngIf="selectedIDS">
      <div class="card-header">
        <h6>
          <button (click)="onClickExport()"
                  ngbTooltip="Export IDS" placement="right"
                  type="button" class="btn"
                  style="color: #15a589; background: transparent; margin: 0px; padding: 0px"><i
            class="fa fa-external-link-alt fa-2x"></i>
          </button>
          {{selectedIDS.name}}</h6>
        <a *ngIf="exportLink" [href]="getHost() + '/' + exportLink">{{getHost()}}/{{exportLink}}</a>
      </div>
      <div class="card-body">
        <table class="table">
          <thead>
          <tr>
            <th colspan="2">PSET</th>
            <th colspan="2">mandatory properties</th>
          </tr>
          </thead>
          <tbody>
          <tr [class]="pset==selectedPset?'link-item selected-item':'link-item'"
              *ngFor="let pset of selectedIDS.reqPsets" (click)="pset!==editedPset?selectPset(pset):''">
            <td>{{pset.propertySetDef.name}}</td>
            <td>
              <button *ngIf="pset==selectedPset" type="button" [class]="'btn'"
                      (click)="removePset(pset)">
                <fa name="minus"></fa>
              </button>
            </td>
            <td *ngIf="!(pset==editedPset)"><span
              *ngFor="let propDef of pset.reqProps; let last = last">{{propDef.name}}{{last ? '' : ', '}}</span>
            <td *ngIf="(pset==editedPset)"><label style="margin-right: 2em"
                                                  *ngFor="let propdef of pset.propertySetDef.propertyDefs"><input
              class="form-check-inline" [checked]="isChecked(propdef, pset)" (change)="onChange(propdef, pset)"
              type="checkbox"> {{propdef.name}}</label>
            </td>
            <td *ngIf="!loadingPropUpdate && pset!==selectedPset"></td>
            <td *ngIf="!loadingPropUpdate && pset==selectedPset">
              <button type="button" [class]="pset===editedPset? 'btn btn-success':'btn'"
                      (click)="toggleEditedPset(pset)">
                <fa name="edit"></fa>
              </button>
            </td>
            <td *ngIf="loadingPropUpdate && pset===editedPset"><i class="fa fa-spinner fa-pulse fa-2x fa-fw"></i>
              <span class="sr-only">Loading...</span></td>
          </tr>
          <tr>
            <td><select class="form-control" [(ngModel)]="selectedPSD" [ngbTooltip]="'Select PSet'">
              <option *ngFor="let pset of allPSDs" [ngValue]="pset">{{pset.name}}</option>
            </select></td>
            <td *ngIf="!loadingPsetUpdate">
              <button type="button" class="btn" [disabled]="!selectedPSD"
                      (click)="addPset(selectedPSD)">
                <fa name="plus"></fa>
              </button>
            </td>
            <td *ngIf="loadingPsetUpdate"><i class=" fa fa-spinner fa-pulse fa-2x fa-fw"></i>
              <span class="sr-only">Loading...</span></td>
          </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
